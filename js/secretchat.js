function BigInteger(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,n,r,i,s){for(;--s>=0;){var o=t*this[e++]+n[r]+i,i=Math.floor(o/67108864);n[r++]=o&67108863}return i}function am2(e,t,n,r,i,s){var o=t&32767;for(t>>=15;--s>=0;){var u=this[e]&32767,a=this[e++]>>15,f=t*u+a*o,u=o*u+((f&32767)<<15)+n[r]+(i&1073741823),i=(u>>>30)+(f>>>15)+t*a+(i>>>30);n[r++]=u&1073741823}return i}function am3(e,t,n,r,i,s){var o=t&16383;for(t>>=14;--s>=0;){var u=this[e]&16383,a=this[e++]>>14,f=t*u+a*o,u=o*u+((f&16383)<<14)+n[r]+i,i=(u>>28)+(f>>14)+t*a;n[r++]=u&268435455}return i}function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var n=BI_RC[e.charCodeAt(t)];return n==null?-1:n}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t;e.s=this.s}function bnpFromInt(e){this.t=1;this.s=e<0?-1:0;e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0}function nbv(e){var t=nbi();t.fromInt(e);return t}function bnpFromString(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else if(t==4)n=2;else{this.fromRadix(e,t);return}this.s=this.t=0;for(var r=e.length,i=!1,s=0;--r>=0;){var o=n==8?e[r]&255:intAt(e,r);o<0?e.charAt(r)=="-"&&(i=!0):(i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB))}if(n==8&&(e[0]&128)!=0)this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s);this.clamp();i&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);if(e==16)e=4;else if(e==8)e=3;else if(e==2)e=1;else if(e==32)e=5;else if(e==64)e=6;else if(e==4)e=2;else return this.toRadix(e);var t=(1<<e)-1,n,r=!1,i="",s=this.t,o=this.DB-s*this.DB%e;if(s-->0){if(o<this.DB&&(n=this[s]>>o)>0)r=!0,i=int2char(n);for(;s>=0;)o<e?(n=(this[s]&(1<<o)-1)<<e-o,n|=this[--s]>>(o+=this.DB-e)):(n=this[s]>>(o-=e)&t,o<=0&&(o+=this.DB,--s)),n>0&&(r=!0),r&&(i+=int2char(n))}return r?i:"0"}function bnNegate(){var e=nbi();BigInteger.ZERO.subTo(this,e);return e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t,t=n-e.t;if(t!=0)return t;for(;--n>=0;)if((t=this[n]-e[n])!=0)return t;return 0}function nbits(e){var t=1,n;if((n=e>>>16)!=0)e=n,t+=16;if((n=e>>8)!=0)e=n,t+=8;if((n=e>>4)!=0)e=n,t+=4;if((n=e>>2)!=0)e=n,t+=2;e>>1!=0&&(t+=1);return t}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e;t.s=this.s}function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0);t.s=this.s}function bnpLShiftTo(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o;t.t=this.t+s+1;t.s=this.s;t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i);t.t=this.t-n;t.clamp()}}function bnpSubTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0;r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r);t.t=n;t.clamp()}function bnpMultiplyTo(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0;t.clamp();this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);if((e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV)e[n+t.t]-=t.DV,e[n+t.t+1]=1}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1));e.s=0;e.clamp()}function bnpDivRemTo(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);else{n==null&&(n=nbi());var s=nbi(),o=this.s,e=e.s,u=this.DB-nbits(r[r.t-1]);u>0?(r.lShiftTo(u,s),i.lShiftTo(u,n)):(r.copyTo(s),i.copyTo(n));r=s.t;i=s[r-1];if(i!=0){var a=i*(1<<this.F1)+(r>1?s[r-2]>>this.F2:0),f=this.FV/a,a=(1<<this.F1)/a,l=1<<this.F2,c=n.t,h=c-r,p=t==null?nbi():t;s.dlShiftTo(h,p);n.compareTo(p)>=0&&(n[n.t++]=1,n.subTo(p,n));BigInteger.ONE.dlShiftTo(r,p);for(p.subTo(s,s);s.t<r;)s[s.t++]=0;for(;--h>=0;){var d=n[--c]==i?this.DM:Math.floor(n[c]*f+(n[c-1]+l)*a);if((n[c]+=s.am(0,d,n,h,0,r))<d){s.dlShiftTo(h,p);for(n.subTo(p,n);n[c]<--d;)n.subTo(p,n)}}t!=null&&(n.drShiftTo(r,t),o!=e&&BigInteger.ZERO.subTo(t,t));n.t=r;n.clamp();u>0&&n.rShiftTo(u,n);o<0&&BigInteger.ZERO.subTo(n,n)}}}}function bnMod(e){var t=nbi();this.abs().divRemTo(e,null,t);this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t);return t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,n){e.multiplyTo(t,n);this.reduce(n)}function cSqrTo(e,t){e.squareTo(t);this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3,t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV;return t>0?this.DV-t:-t}function Montgomery(e){this.m=e;this.mp=e.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<e.DB-15)-1;this.mt2=2*e.t}function montConvert(e){var t=nbi();e.abs().dlShiftTo(this.m.t,t);t.divRemTo(this.m,null,t);e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t);return t}function montRevert(e){var t=nbi();e.copyTo(t);this.reduce(t);return t}function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM,n=t+this.m.t;for(e[n]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp();e.drShiftTo(this.m.t,e);e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t);this.reduce(t)}function montMulTo(e,t,n){e.multiplyTo(t,n);this.reduce(n)}function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger.ONE;var n=nbi(),r=nbi(),i=t.convert(this),s=nbits(e)-1;for(i.copyTo(n);--s>=0;)if(t.sqrTo(n,r),(e&1<<s)>0)t.mulTo(r,i,n);else var o=n,n=r,r=o;return t.revert(n)}function bnModPowInt(e,t){var n;n=e<256||t.isEven()?new Classic(t):new Montgomery(t);return this.exp(e,n)}function bnClone(){var e=nbi();this.copyTo(e);return e}function bnIntValue(){if(this.s<0)if(this.t==1)return this[0]-this.DV;else{if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function bnpToRadix(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),t=Math.pow(e,t),n=nbv(t),r=nbi(),i=nbi(),s="";for(this.divRemTo(n,r,i);r.signum()>0;)s=(t+i.intValue()).toString(e).substr(1)+s,r.divRemTo(n,r,i);return i.intValue().toString(e)+s}function bnpFromRadix(e,t){this.fromInt(0);t==null&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0,u=0;u<e.length;++u){var a=intAt(e,u);a<0?e.charAt(u)=="-"&&this.signum()==0&&(i=!0):(o=t*o+a,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),o=s=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0));i&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n);this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this);for(this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this)}else{var n=[],r=e&7;n.length=(e>>3)+1;t.nextBytes(n);r>0?n[0]&=(1<<r)-1:n[0]=0;this.fromString(n,256)}}function bnToByteArray(){var e=this.t,t=[];t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){if(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n)t[i++]=r|this.s<<this.DB-n;for(;e>=0;)if(n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i,i>0||r!=this.s)t[i++]=r}return t}function bnEquals(e){return this.compareTo(e)==0}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s);n.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();this.bitwiseTo(e,op_and,t);return t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();this.bitwiseTo(e,op_or,t);return t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();this.bitwiseTo(e,op_xor,t);return t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();this.bitwiseTo(e,op_andnot,t);return t}function bnNot(){for(var e=nbi(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];e.t=this.t;e.s=~this.s;return e}function bnShiftLeft(e){var t=nbi();e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t);return t}function bnShiftRight(e){var t=nbi();e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t);return t}function lbit(e){if(e==0)return-1;var t=0;(e&65535)==0&&(e>>=16,t+=16);(e&255)==0&&(e>>=8,t+=8);(e&15)==0&&(e>>=4,t+=4);(e&3)==0&&(e>>=2,t+=2);(e&1)==0&&++t;return t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){for(var t=0;e!=0;)e&=e-1,++t;return t}function bnBitCount(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=cbit(this[n]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);this.bitwiseTo(n,t,n);return n}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0;r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r);t.t=n;t.clamp()}function bnAdd(e){var t=nbi();this.addTo(e,t);return t}function bnSubtract(e){var t=nbi();this.subTo(e,t);return t}function bnMultiply(e){var t=nbi();this.multiplyTo(e,t);return t}function bnSquare(){var e=nbi();this.squareTo(e);return e}function bnDivide(e){var t=nbi();this.divRemTo(e,t,null);return t}function bnRemainder(e){var t=nbi();this.divRemTo(e,null,t);return t}function bnDivideAndRemainder(e){var t=nbi(),n=nbi();this.divRemTo(e,t,n);return[t,n]}function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(e,t){if(e!=0){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,n){e.multiplyTo(t,n)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0;for(n.t=r;r>0;)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function bnpMultiplyUpperTo(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp();n.drShiftTo(1,n)}function Barrett(e){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*e.t,this.r2);this.mu=this.r2.divide(e);this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);else if(e.compareTo(this.m)<0)return e;else{var t=nbi();e.copyTo(t);this.reduce(t);return t}}function barrettRevert(e){return e}function barrettReduce(e){e.drShiftTo(this.m.t-1,this.r2);if(e.t>this.m.t+1)e.t=this.m.t+1,e.clamp();this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t);this.reduce(t)}function barrettMulTo(e,t,n){e.multiplyTo(t,n);this.reduce(n)}function bnModPow(e,t){var n=e.bitLength(),r,i=nbv(1),s;if(n<=0)return i;else r=n<18?1:n<48?3:n<144?4:n<768?5:6;s=n<8?new Classic(t):t.isEven()?new Barrett(t):new Montgomery(t);var o=[],u=3,a=r-1,f=(1<<r)-1;o[1]=s.convert(this);if(r>1){n=nbi();for(s.sqrTo(o[1],n);u<=f;)o[u]=nbi(),s.mulTo(n,o[u-2],o[u]),u+=2}for(var l=e.t-1,c,h=!0,p=nbi(),n=nbits(e[l])-1;l>=0;){n>=a?c=e[l]>>n-a&f:(c=(e[l]&(1<<n+1)-1)<<a-n,l>0&&(c|=e[l-1]>>this.DB+n-a));for(u=r;(c&1)==0;)c>>=1,--u;if((n-=u)<0)n+=this.DB,--l;if(h)o[c].copyTo(i),h=!1;else{for(;u>1;)s.sqrTo(i,p),s.sqrTo(p,i),u-=2;u>0?s.sqrTo(i,p):(u=i,i=p,p=u);s.mulTo(p,o[c],i)}for(;l>=0&&(e[l]&1<<n)==0;)s.sqrTo(i,p),u=i,i=p,p=u,--n<0&&(n=this.DB-1,--l)}return s.revert(i)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),e=e.s<0?e.negate():e.clone();if(t.compareTo(e)<0)var n=t,t=e,e=n;var n=t.getLowestSetBit(),r=e.getLowestSetBit();if(r<0)return t;n<r&&(r=n);r>0&&(t.rShiftTo(r,t),e.rShiftTo(r,e));for(;t.signum()>0;)(n=t.getLowestSetBit())>0&&t.rShiftTo(n,t),(n=e.getLowestSetBit())>0&&e.rShiftTo(n,e),t.compareTo(e)>=0?(t.subTo(e,t),t.rShiftTo(1,t)):(e.subTo(t,e),e.rShiftTo(1,e));r>0&&e.lShiftTo(r,e);return e}function bnpModInt(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return BigInteger.ZERO;for(var n=e.clone(),r=this.clone(),i=nbv(1),s=nbv(0),o=nbv(0),u=nbv(1);n.signum()!=0;){for(;n.isEven();){n.rShiftTo(1,n);if(t){if(!i.isEven()||!s.isEven())i.addTo(this,i),s.subTo(e,s);i.rShiftTo(1,i)}else s.isEven()||s.subTo(e,s);s.rShiftTo(1,s)}for(;r.isEven();){r.rShiftTo(1,r);if(t){if(!o.isEven()||!u.isEven())o.addTo(this,o),u.subTo(e,u);o.rShiftTo(1,o)}else u.isEven()||u.subTo(e,u);u.rShiftTo(1,u)}n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(u,s)):(r.subTo(n,r),t&&o.subTo(i,o),u.subTo(s,u))}if(r.compareTo(BigInteger.ONE)!=0)return BigInteger.ZERO;if(u.compareTo(e)>=0)return u.subtract(e);if(u.signum()<0)u.addTo(e,u);else return u;return u.signum()<0?u.add(e):u}function bnIsProbablePrime(e){var t,n=this.abs();if(n.t==1&&n[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(n[0]==lowprimes[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<lowprimes.length;){for(var r=lowprimes[t],i=t+1;i<lowprimes.length&&r<lplim;)r*=lowprimes[i++];for(r=n.modInt(r);t<i;)if(r%lowprimes[t++]==0)return!1}return n.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n),e=e+1>>1;if(e>lowprimes.length)e=lowprimes.length;for(var i=nbi(),s=0;s<e;++s){i.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var o=i.modPow(r,this);if(o.compareTo(BigInteger.ONE)!=0&&o.compareTo(t)!=0){for(var u=1;u++<n&&o.compareTo(t)!=0;)if(o=o.modPowInt(2,this),o.compareTo(BigInteger.ONE)==0)return!1;if(o.compareTo(t)!=0)return!1}}return!0}function SeededRandom(){}function SRnextBytes(e){var t;for(t=0;t<e.length;t++)e[t]=Math.floor(Math.random()*256)}function Arcfour(){this.j=this.i=0;this.S=[]}function ARC4init(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;for(t=n=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.j=this.i=0}function ARC4next(){var e;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;e=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=e;return this.S[e+this.S[this.i]&255]}function prng_newstate(){return new Arcfour}function rng_seed_int(e){rng_pool[rng_pptr++]^=e&255;rng_pool[rng_pptr++]^=e>>8&255;rng_pool[rng_pptr++]^=e>>16&255;rng_pool[rng_pptr++]^=e>>24&255;rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(e){var t;for(t=0;t<e.length;++t)e[t]=rng_get_byte()}function SecureRandom(){}function SHA256(e){function t(e,t){var n=(e&65535)+(t&65535);return(e>>16)+(t>>16)+(n>>16)<<16|n&65535}function n(e,t){return e>>>t|e<<32-t}e=function(e){for(var e=e.replace(/\r\n/g,"\n"),t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(r>127&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(r&63|128))}return t}(e);return function(e){for(var t="",n=0;n<e.length*4;n++)t+="0123456789abcdef".charAt(e[n>>2]>>(3-n%4)*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>(3-n%4)*8&15);return t}(function(e,r){var i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],o=Array(64),u,a,f,l,h,p,d,v,m,g,y,w;e[r>>5]|=128<<24-r%32;e[(r+64>>9<<4)+15]=r;for(m=0;m<e.length;m+=16){u=s[0];a=s[1];f=s[2];l=s[3];h=s[4];p=s[5];d=s[6];v=s[7];for(g=0;g<64;g++)o[g]=g<16?e[g+m]:t(t(t(n(o[g-2],17)^n(o[g-2],19)^o[g-2]>>>10,o[g-7]),n(o[g-15],7)^n(o[g-15],18)^o[g-15]>>>3),o[g-16]),y=t(t(t(t(v,n(h,6)^n(h,11)^n(h,25)),h&p^~h&d),i[g]),o[g]),w=t(n(u,2)^n(u,13)^n(u,22),u&a^u&f^a&f),v=d,d=p,p=h,h=t(l,y),l=f,f=a,a=u,u=t(y,w);s[0]=t(u,s[0]);s[1]=t(a,s[1]);s[2]=t(f,s[2]);s[3]=t(l,s[3]);s[4]=t(h,s[4]);s[5]=t(p,s[5]);s[6]=t(d,s[6]);s[7]=t(v,s[7])}return s}(function(e){for(var t=[],n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}(e),e.length*8))}function SHA1(e){function t(e,t){return e<<t|e>>>32-t}function n(e){var t="",n,r;for(n=7;n>=0;n--)r=e>>>n*4&15,t+=r.toString(16);return t}var r,i,s=Array(80),o=1732584193,u=4023233417,a=2562383102,f=271733878,l=3285377520,c,h,p,d,v,e=function(e){for(var e=e.replace(/\r\n/g,"\n"),t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(r>127&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(r&63|128))}return t}(e);c=e.length;var m=[];for(r=0;r<c-3;r+=4)i=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),m.push(i);switch(c%4){case 0:r=2147483648;break;case 1:r=e.charCodeAt(c-1)<<24|8388608;break;case 2:r=e.charCodeAt(c-2)<<24|e.charCodeAt(c-1)<<16|32768;break;case 3:r=e.charCodeAt(c-3)<<24|e.charCodeAt(c-2)<<16|e.charCodeAt(c-1)<<8|128}for(m.push(r);m.length%16!=14;)m.push(0);m.push(c>>>29);m.push(c<<3&4294967295);for(e=0;e<m.length;e+=16){for(r=0;r<16;r++)s[r]=m[e+r];for(r=16;r<=79;r++)s[r]=t(s[r-3]^s[r-8]^s[r-14]^s[r-16],1);i=o;c=u;h=a;p=f;d=l;for(r=0;r<=19;r++)v=t(i,5)+(c&h|~c&p)+d+s[r]+1518500249&4294967295,d=p,p=h,h=t(c,30),c=i,i=v;for(r=20;r<=39;r++)v=t(i,5)+(c^h^p)+d+s[r]+1859775393&4294967295,d=p,p=h,h=t(c,30),c=i,i=v;for(r=40;r<=59;r++)v=t(i,5)+(c&h|c&p|h&p)+d+s[r]+2400959708&4294967295,d=p,p=h,h=t(c,30),c=i,i=v;for(r=60;r<=79;r++)v=t(i,5)+(c^h^p)+d+s[r]+3395469782&4294967295,d=p,p=h,h=t(c,30),c=i,i=v;o=o+i&4294967295;u=u+c&4294967295;a=a+h&4294967295;f=f+p&4294967295;l=l+d&4294967295}v=n(o)+n(u)+n(a)+n(f)+n(l);return v.toLowerCase()}function parseBigInt(e,t){return new BigInteger(e,t)}function linebrk(e,t){for(var n="",r=0;r+t<e.length;)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function byte2Hex(e){return e<16?"0"+e.toString(16):e.toString(16)}function pkcs1pad2(e,t){if(t<e.length+11)throw"Message too long for RSA (n="+t+", l="+e.length+")";for(var n=[],r=e.length-1;r>=0&&t>0;){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=i&63|128,n[--t]=i>>6|192):(n[--t]=i&63|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;r=new SecureRandom;for(i=[];t>2;){for(i[0]=0;i[0]==0;)r.nextBytes(i);n[--t]=i[0]}n[--t]=2;n[--t]=0;return new BigInteger(n)}function RSAKey(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=this.q=this.p=this.d=null}function RSASetPublic(e,t){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16)):alert("Invalid RSA public key")}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){e=pkcs1pad2(e,this.n.bitLength()+7>>3);if(e==null)return null;e=this.doPublic(e);if(e==null)return null;e=e.toString(16);return(e.length&1)==0?e:"0"+e}function pkcs1unpad2(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&n[r]==0;)++r;if(n.length-r!=t-1||n[r]!=2)return null;for(++r;n[r]!=0;)if(++r>=n.length)return null;for(var i="";++r<n.length;){var s=n[r]&255;s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((s&31)<<6|n[r+1]&63),++r):(i+=String.fromCharCode((s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63),r+=2)}return i}function RSASetPrivate(e,t,n){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16)):alert("Invalid RSA private key")}function RSASetPrivateEx(e,t,n,r,i,s,o,u){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16),this.p=parseBigInt(r,16),this.q=parseBigInt(i,16),this.dmp1=parseBigInt(s,16),this.dmq1=parseBigInt(o,16),this.coeff=parseBigInt(u,16)):alert("Invalid RSA private key")}function RSAGenerate(e,t){var n=new SeededRandom,r=e>>1;this.e=parseInt(t,16);for(var i=new BigInteger(t,16);;){for(;;)if(this.p=new BigInteger(e-r,1,n),this.p.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)==0&&this.p.isProbablePrime(10))break;for(;;)if(this.q=new BigInteger(r,1,n),this.q.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)==0&&this.q.isProbablePrime(10))break;if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q;this.q=s}var s=this.p.subtract(BigInteger.ONE),o=this.q.subtract(BigInteger.ONE),u=s.multiply(o);if(u.gcd(i).compareTo(BigInteger.ONE)==0){this.n=this.p.multiply(this.q);this.d=i.modInverse(u);this.dmp1=this.d.mod(s);this.dmq1=this.d.mod(o);this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),e=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(e)<0;)t=t.add(this.p);return t.subtract(e).multiply(this.coeff).mod(this.p).multiply(this.q).add(e)}function RSADecrypt(e){e=this.doPrivate(parseBigInt(e,16));return e==null?null:pkcs1unpad2(e,this.n.bitLength()+7>>3)}function _rsasign_getHexPaddedDigestInfoForString(e,t,n){t/=4;for(var e=(0,_RSASIGN_HASHHEXFUNC[n])(e),n="00"+_RSASIGN_DIHEAD[n]+e,e="",t=t-4-n.length,r=0;r<t;r+=2)e+="ff";return sPaddedMessageHex="0001"+e+n}function _rsasign_signString(e,t){var n=_rsasign_getHexPaddedDigestInfoForString(e,this.n.bitLength(),t);return this.doPrivate(parseBigInt(n,16)).toString(16)}function _rsasign_signStringWithSHA1(e){e=_rsasign_getHexPaddedDigestInfoForString(e,this.n.bitLength(),"sha1");return this.doPrivate(parseBigInt(e,16)).toString(16)}function _rsasign_signStringWithSHA256(e){e=_rsasign_getHexPaddedDigestInfoForString(e,this.n.bitLength(),"sha256");return this.doPrivate(parseBigInt(e,16)).toString(16)}function _rsasign_getDecryptSignatureBI(e,t,n){var r=new RSAKey;r.setPublic(t,n);return r.doPublic(e)}function _rsasign_getHexDigestInfoFromSig(e,t,n){return _rsasign_getDecryptSignatureBI(e,t,n).toString(16).replace(/^1f+00/,"")}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(e){for(var t in _RSASIGN_DIHEAD){var n=_RSASIGN_DIHEAD[t],r=n.length;if(e.substring(0,r)==n)return[t,e.substring(r)]}return[]}function _rsasign_verifySignatureWithArgs(e,t,n,r){t=_rsasign_getHexDigestInfoFromSig(t,n,r);n=_rsasign_getAlgNameAndHashFromHexDisgestInfo(t);if(n.length==0)return!1;t=n[1];e=(0,_RSASIGN_HASHHEXFUNC[n[0]])(e);return t==e}function _rsasign_verifyHexSignatureForMessage(e,t){var n=parseBigInt(e,16);return _rsasign_verifySignatureWithArgs(t,n,this.n.toString(16),this.e.toString(16))}function _rsasign_verifyString(e,t){var t=t.replace(/[ \n]+/g,""),n=this.doPublic(parseBigInt(t,16)).toString(16).replace(/^1f+00/,""),r=_rsasign_getAlgNameAndHashFromHexDisgestInfo(n);if(r.length==0)return!1;n=r[1];r=(0,_RSASIGN_HASHHEXFUNC[r[0]])(e);return n==r}function escapeHtml(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function encode(e){return encodeURIComponent(escape(e))}function decode(e){return unescape(decodeURIComponent(e))}function addZero(e){if(e<10){e="0"+e}return e}function getRandomStr(e){result="";var t="0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOP?ASDFGHJKLZXCVBNM+=-%^$#@!;:|/><(*){}№.~`_";var n=t.length-1;for(i=0;i<e;++i){position=Math.floor(Math.random()*n);result=result+t.substring(position,position+1)}return result}function connect(e){startMessaging();if(e.label==="chat"){var t=$("<div></div>").addClass("connection").addClass("active").attr("id",e.peer);var n=$('<div><em class="notification">The conversation started. Start messaging!</em></div>').addClass("messages");t.append(n);$(".filler").hide();$("#connections").append(t);e.on("data",function(e){decryptedMsg=cryptico.decrypt(e,RSAkey);decryptedMsg.plaintext=escapeHtml(decode(decryptedMsg.plaintext));n.append('<div class="message_block partner"><span class="date">'+(new Date).getHours()+":"+addZero((new Date).getMinutes())+'</span> <span class="peer">Partner:</span><div class="message">'+decryptedMsg.plaintext.replace(/([^>])\n/g,"$1<br/>")+"</div></div>");$("html, body").animate({scrollTop:$(document).height()},"slow");notification.play()});e.on("close",function(){alert("Partner has left the chat.");$(".chat").hide();if($(".connection").length===0){$(".filler").show()}delete connectedPeers[e.peer]})}connectedPeers[e.peer]=1}(function(e){function t(){this._pieces=[],this._parts=[]}function n(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function r(){this.bufferBuilder=new t}function i(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function s(e){return e.length>600?(new Blob([e])).size:e.replace(/[^\u0000-\u007F]/g,i).length}function o(){this._events={}}function u(e,t){if(!(this instanceof u))return new u(e);this._dc=e,m.debug=t,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}function a(e,t){if(!(this instanceof a))return new a(e,t);o.call(this),e&&e.constructor==Object?(t=e,e=undefined):e&&(e=e.toString()),t=m.extend({debug:0,host:m.CLOUD_HOST,port:m.CLOUD_PORT,key:"peerjs",path:"/",token:m.randomToken(),config:m.defaultConfig},t),this.options=t,t.host==="/"&&(t.host=window.location.hostname),t.path[0]!=="/"&&(t.path="/"+t.path),t.path[t.path.length-1]!=="/"&&(t.path+="/"),t.secure===undefined&&t.host!==m.CLOUD_HOST&&(t.secure=m.isSecure()),t.logFunction&&m.setLogFunction(t.logFunction),m.setLogLevel(t.debug);if(!m.supports.audioVideo&&!m.supports.data){this._delayedAbort("browser-incompatible","The current browser does not support WebRTC");return}if(!m.validateId(e)){this._delayedAbort("invalid-id",'ID "'+e+'" is invalid');return}if(!m.validateKey(t.key)){this._delayedAbort("invalid-key",'API KEY "'+t.key+'" is invalid');return}if(t.secure&&t.host==="0.peerjs.com"){this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.");return}this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),e?this._initialize(e):this._retrieveId()}function f(e,t,n){if(!(this instanceof f))return new f(e,t,n);o.call(this),this.options=m.extend({serialization:"binary",reliable:!1},n),this.open=!1,this.type="data",this.peer=e,this.provider=t,this.id=this.options.connectionId||f._idPrefix+m.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),g.startConnection(this,this.options._payload||{originator:!0})}function l(e,t,n){if(!(this instanceof l))return new l(e,t,n);o.call(this),this.options=m.extend({},n),this.open=!1,this.type="media",this.peer=e,this.provider=t,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||l._idPrefix+m.randomToken(),this.localStream&&g.startConnection(this,{_stream:this.localStream,originator:!0})}function c(e,t,n,r,i){if(!(this instanceof c))return new c(e,t,n,r,i);o.call(this),this.disconnected=!1,this._queue=[];var s=e?"https://":"http://",u=e?"wss://":"ws://";this._httpUrl=s+t+":"+n+r+i,this._wsUrl=u+t+":"+n+r+"peerjs?key="+i}var h={};h.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),h.useArrayBufferView=!h.useBlobBuilder&&function(){try{return(new Blob([new Uint8Array([])])).size===0}catch(e){return!0}}(),e.binaryFeatures=h,e.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder,t.prototype.append=function(e){typeof e=="number"?this._pieces.push(e):(this.flush(),this._parts.push(e))},t.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);h.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},t.prototype.getBuffer=function(){this.flush();if(h.useBlobBuilder){var e=new BlobBuilder;for(var t=0,n=this._parts.length;t<n;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},e.BinaryPack={unpack:function(e){var t=new n(e);return t.unpack()},pack:function(e){var t=new r;t.pack(e);var n=t.getBuffer();return n}},n.prototype.unpack=function(){var e=this.unpack_uint8();if(e<128){var t=e;return t}if((e^224)<32){var n=(e^224)-32;return n}var r;if((r=e^160)<=15)return this.unpack_raw(r);if((r=e^176)<=15)return this.unpack_string(r);if((r=e^144)<=15)return this.unpack_array(r);if((r=e^128)<=15)return this.unpack_map(r);switch(e){case 192:return null;case 193:return undefined;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return undefined;case 213:return undefined;case 214:return undefined;case 215:return undefined;case 216:return r=this.unpack_uint16(),this.unpack_string(r);case 217:return r=this.unpack_uint32(),this.unpack_string(r);case 218:return r=this.unpack_uint16(),this.unpack_raw(r);case 219:return r=this.unpack_uint32(),this.unpack_raw(r);case 220:return r=this.unpack_uint16(),this.unpack_array(r);case 221:return r=this.unpack_uint32(),this.unpack_array(r);case 222:return r=this.unpack_uint16(),this.unpack_map(r);case 223:return r=this.unpack_uint32(),this.unpack_map(r)}},n.prototype.unpack_uint8=function(){var e=this.dataView[this.index]&255;return this.index++,e},n.prototype.unpack_uint16=function(){var e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t},n.prototype.unpack_uint32=function(){var e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t},n.prototype.unpack_uint64=function(){var e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t},n.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},n.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},n.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},n.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},n.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},n.prototype.unpack_string=function(e){var t=this.read(e),n=0,r="",i,s;while(n<e)i=t[n],i<128?(r+=String.fromCharCode(i),n++):(i^192)<32?(s=(i^192)<<6|t[n+1]&63,r+=String.fromCharCode(s),n+=2):(s=(i&15)<<12|(t[n+1]&63)<<6|t[n+2]&63,r+=String.fromCharCode(s),n+=3);return this.index+=e,r},n.prototype.unpack_array=function(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=this.unpack();return t},n.prototype.unpack_map=function(e){var t={};for(var n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},n.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=e&8388607|8388608;return(t==0?1:-1)*r*Math.pow(2,n-23)},n.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,i=e&1048575|1048576,s=i*Math.pow(2,r-20)+t*Math.pow(2,r-52);return(n==0?1:-1)*s},n.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},r.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},r.prototype.pack=function(e){var t=typeof e;if(t=="string")this.pack_string(e);else if(t=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(t=="boolean")e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if(t=="undefined")this.bufferBuilder.append(192);else{if(t!="object")throw new Error('Type "'+t+'" not yet supported');if(e===null)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File)this.pack_bin(e);else if(n==ArrayBuffer)h.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)h.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object)this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if(typeof e.toBinaryPack!="function")throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},r.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},r.prototype.pack_string=function(e){var t=s(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},r.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},r.prototype.pack_integer=function(e){if(-32<=e&&e<=127)this.bufferBuilder.append(e&255);else if(0<=e&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},r.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),s=Math.pow(2,32),o=t<<31|n+1023<<20|i/s&1048575,u=i%s;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(u)},r.prototype.pack_object=function(e){var t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this.bufferBuilder.append(222),this.pack_uint16(n);else{if(!(n<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(n)}for(var r in e)e.hasOwnProperty(r)&&(this.pack(r),this.pack(e[r]))},r.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},r.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(e&255)},r.prototype.pack_uint32=function(e){var t=e&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)},r.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((n&4278190080)>>>24),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)},r.prototype.pack_int8=function(e){this.bufferBuilder.append(e&255)},r.prototype.pack_int16=function(e){this.bufferBuilder.append((e&65280)>>8),this.bufferBuilder.append(e&255)},r.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)},r.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((n&4278190080)>>>24),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};var p=Array.isArray;o.prototype.addListener=function(e,t,n,r){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this.emit("newListener",e,typeof t.listener=="function"?t.listener:t),this._events[e]?p(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(e,t,n){function r(){i.removeListener(e,r),t.apply(this,arguments)}if("function"!=typeof t)throw new Error(".once only takes instances of Function");var i=this;return r.listener=t,i.on(e,r),this},o.prototype.removeListener=function(e,t,n){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e];if(p(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;r.splice(i,1),r.length==0&&delete this._events[e]}else(r===t||r.listener&&r.listener===t)&&delete this._events[e];return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){return arguments.length===0?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},o.prototype.listeners=function(e){return this._events[e]||(this._events[e]=[]),p(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.emit=function(e){var e=arguments[0],t=this._events[e];if(!t)return!1;if(typeof t=="function"){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=arguments.length,r=new Array(n-1);for(var i=1;i<n;i++)r[i-1]=arguments[i];t.apply(this,r)}return!0}if(p(t)){var n=arguments.length,r=new Array(n-1);for(var i=1;i<n;i++)r[i-1]=arguments[i];var s=t.slice();for(var i=0,n=s.length;i<n;i++)s[i].apply(this,r);return!0}return!1},u.prototype.send=function(e){var t=m.pack(e);if(t.size<this._mtu){this._handleSend(["no",t]);return}this._outgoing[this._count]={ack:0,chunks:this._chunk(t)},m.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1},u.prototype._setupInterval=function(){var e=this;this._timeout=setInterval(function(){var t=e._queue.shift();if(t._multiple)for(var n=0,r=t.length;n<r;n+=1)e._intervalSend(t[n]);else e._intervalSend(t)},this._interval)},u.prototype._intervalSend=function(e){var t=this;e=m.pack(e),m.blobToBinaryString(e,function(e){t._dc.send(e)}),t._queue.length===0&&(clearTimeout(t._timeout),t._timeout=null)},u.prototype._processAcks=function(){for(var e in this._outgoing)this._outgoing.hasOwnProperty(e)&&this._sendWindowedChunks(e)},u.prototype._handleSend=function(e){var t=!0;for(var n=0,r=this._queue.length;n<r;n+=1){var i=this._queue[n];i===e?t=!1:i._multiple&&i.indexOf(e)!==-1&&(t=!1)}t&&(this._queue.push(e),this._timeout||this._setupInterval())},u.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(t){var n=t.data,r=n.constructor;if(r===String){var i=m.binaryStringToArrayBuffer(n);n=m.unpack(i),e._handleMessage(n)}}},u.prototype._handleMessage=function(e){var t=e[1],n=this._incoming[t],r=this._outgoing[t],i;switch(e[0]){case"no":var s=t;!s||this.onmessage(m.unpack(s));break;case"end":i=n,this._received[t]=e[2];if(!i)break;this._ack(t);break;case"ack":i=r;if(!!i){var o=e[2];i.ack=Math.max(o,i.ack),i.ack>=i.chunks.length?(m.log("Time: ",new Date-i.timer),delete this._outgoing[t]):this._processAcks()}break;case"chunk":i=n;if(!i){var u=this._received[t];if(u===!0)break;i={ack:["ack",t,0],chunks:[]},this._incoming[t]=i}var a=e[2],f=e[3];i.chunks[a]=new Uint8Array(f),a===i.ack[2]&&this._calculateNextAck(t),this._ack(t);break;default:this._handleSend(e)}},u.prototype._chunk=function(e){var t=[],n=e.size,r=0;while(r<n){var i=Math.min(n,r+this._mtu),s=e.slice(r,i),o={payload:s};t.push(o),r=i}return m.log("Created",t.length,"chunks."),t},u.prototype._ack=function(e){var t=this._incoming[e].ack;this._received[e]===t[2]&&(this._complete(e),this._received[e]=!0),this._handleSend(t)},u.prototype._calculateNextAck=function(e){var t=this._incoming[e],n=t.chunks;for(var r=0,i=n.length;r<i;r+=1)if(n[r]===undefined){t.ack[2]=r;return}t.ack[2]=n.length},u.prototype._sendWindowedChunks=function(e){m.log("sendWindowedChunks for: ",e);var t=this._outgoing[e],n=t.chunks,r=[],i=Math.min(t.ack+this._window,n.length);for(var s=t.ack;s<i;s+=1)if(!n[s].sent||s===t.ack)n[s].sent=!0,r.push(["chunk",e,s,n[s].payload]);t.ack+this._window>=n.length&&r.push(["end",e,n.length]),r._multiple=!0,this._handleSend(r)},u.prototype._complete=function(e){m.log("Completed called for",e);var t=this,n=this._incoming[e].chunks,r=new Blob(n);m.blobToArrayBuffer(r,function(e){t.onmessage(m.unpack(e))}),delete this._incoming[e]},u.higherBandwidthSDP=function(e){var t=navigator.appVersion.match(/Chrome\/(.*?) /);if(t){t=parseInt(t[1].split(".").shift());if(t<31){var n=e.split("b=AS:30"),r="b=AS:102400";if(n.length>1)return n[0]+r+n[1]}}return e},u.prototype.onmessage=function(e){},e.Reliable=u,e.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,e.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;var d={iceServers:[{url:"stun:stun.l.google.com:19302"}]},v=1,m={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var t=parseInt(e,10);isNaN(parseInt(e,10))?m.logLevel=e?3:0:m.logLevel=t,m.log=m.warn=m.error=m.noop,m.logLevel>0&&(m.error=m._printWith("ERROR")),m.logLevel>1&&(m.warn=m._printWith("WARNING")),m.logLevel>2&&(m.log=m._print)},setLogFunction:function(e){e.constructor!==Function?m.warn("The log function you passed in is not a function. Defaulting to regular logs."):m._print=e},_printWith:function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),m._print.apply(m,t)}},_print:function(){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,r=t.length;n<r;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)},defaultConfig:d,browser:function(){return window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported"}(),supports:function(){if(typeof RTCPeerConnection=="undefined")return{};var e=!0,t=!0,n=!1,r=!1,i=!!window.webkitRTCPeerConnection,s,o;try{s=new RTCPeerConnection(d,{optional:[{RtpDataChannels:!0}]})}catch(u){e=!1,t=!1}if(e)try{o=s.createDataChannel("_PEERJSTEST")}catch(u){e=!1}if(e){try{o.binaryType="blob",n=!0}catch(u){}var a=new RTCPeerConnection(d,{});try{var f=a.createDataChannel("_PEERJSRELIABLETEST",{});r=f.reliable}catch(u){}a.close()}t&&(t=!!s.addStream);if(!i&&e){var l=new RTCPeerConnection(d,{optional:[{RtpDataChannels:!0}]});l.onnegotiationneeded=function(){i=!0,m&&m.supports&&(m.supports.onnegotiationneeded=!0)};var c=l.createDataChannel("_PEERJSNEGOTIATIONTEST");setTimeout(function(){l.close()},1e3)}return s&&s.close(),{audioVideo:t,data:e,binaryBlob:n,binary:r,reliable:r,sctp:r,onnegotiationneeded:i}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},pack:BinaryPack.pack,unpack:BinaryPack.unpack,log:function(){if(m.debug){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,r=t.length;n<r;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)}},setZeroTimeout:function(e){function t(t){r.push(t),e.postMessage(i,"*")}function n(t){t.source==e&&t.data==i&&(t.stopPropagation&&t.stopPropagation(),r.length&&r.shift()())}var r=[],i="zero-timeout-message";return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),t}(this),chunk:function(e){var t=[],n=e.size,r=index=0,i=Math.ceil(n/m.chunkedMTU);while(r<n){var s=Math.min(n,r+m.chunkedMTU),o=e.slice(r,s),u={__peerData:v,n:index,data:o,total:i};t.push(u),r=s,index+=1}return v+=1,t},blobToArrayBuffer:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return location.protocol==="https:"}};e.util=m,m.inherits(a,o),a.prototype._initializeServerConnection=function(){var e=this;this.socket=new c(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key),this.socket.on("message",function(t){e._handleMessage(t)}),this.socket.on("error",function(t){e._abort("socket-error",t)}),this.socket.on("disconnected",function(){e.disconnected||(e.emitError("network","Lost connection to server."),e.disconnect())}),this.socket.on("close",function(){e.disconnected||e._abort("socket-closed","Underlying socket is already closed.")})},a.prototype._retrieveId=function(e){var t=this,n=new XMLHttpRequest,r=this.options.secure?"https://":"http://",i=r+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id",s="?ts="+(new Date).getTime()+""+Math.random();i+=s,n.open("get",i,!0),n.onerror=function(e){m.error("Error retrieving ID",e);var n="";t.options.path==="/"&&t.options.host!==m.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),t._abort("server-error","Could not get an ID from the server."+n)},n.onreadystatechange=function(){if(n.readyState!==4)return;if(n.status!==200){n.onerror();return}t._initialize(n.responseText)},n.send(null)},a.prototype._initialize=function(e){this.id=e,this.socket.start(this.id,this.options.token)},a.prototype._handleMessage=function(e){var t=e.type,n=e.payload,r=e.src;switch(t){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",n.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":m.log("Received leave message from",r),this._cleanupPeer(r);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+r);break;case"OFFER":var i=n.connectionId,s=this.getConnection(r,i);if(s)m.warn("Offer received for existing Connection ID:",i);else{if(n.type==="media"){var s=new l(r,this,{connectionId:i,_payload:n,metadata:n.metadata});this._addConnection(r,s),this.emit("call",s)}else{if(n.type!=="data"){m.warn("Received malformed connection type:",n.type);return}s=new f(r,this,{connectionId:i,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable}),this._addConnection(r,s),this.emit("connection",s)}var o=this._getMessages(i);for(var u=0,a=o.length;u<a;u+=1)s.handleMessage(o[u])}break;default:if(!n){m.warn("You received a malformed message from "+r+" of type "+t);return}var c=n.connectionId,s=this.getConnection(r,c);s&&s.pc?s.handleMessage(e):c?this._storeMessage(c,e):m.warn("You received an unrecognized message:",e)}},a.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},a.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},a.prototype.connect=function(e,t){if(this.disconnected){m.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}var n=new f(e,this,t);return this._addConnection(e,n),n},a.prototype.call=function(e,t,n){if(this.disconnected){m.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}if(!t){m.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}n=n||{},n._stream=t;var r=new l(e,this,n);return this._addConnection(e,r),r},a.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},a.prototype.getConnection=function(e,t){var n=this.connections[e];if(!n)return null;for(var r=0,i=n.length;r<i;r++)if(n[r].id===t)return n[r];return null},a.prototype._delayedAbort=function(e,t){var n=this;m.setZeroTimeout(function(){n._abort(e,t)})},a.prototype._abort=function(e,t){m.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},a.prototype.emitError=function(e,t){m.error("Error:",t),typeof t=="string"&&(t=new Error(t)),t.type=e,this.emit("error",t)},a.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},a.prototype._cleanup=function(){if(this.connections){var e=Object.keys(this.connections);for(var t=0,n=e.length;t<n;t++)this._cleanupPeer(e[t])}this.emit("close")},a.prototype._cleanupPeer=function(e){var t=this.connections[e];for(var n=0,r=t.length;n<r;n+=1)t[n].close()},a.prototype.disconnect=function(){var e=this;m.setZeroTimeout(function(){e.disconnected||(e.disconnected=!0,e.open=!1,e.socket&&e.socket.close(),e.emit("disconnected",e.id),e._lastServerId=e.id,e.id=null)})},a.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)m.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!!this.disconnected||!!this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");m.error("In a hurry? We're still trying to make the initial connection!")}},a.prototype.listAllPeers=function(e){e=e||function(){};var t=this,n=new XMLHttpRequest,r=this.options.secure?"https://":"http://",i=r+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers",s="?ts="+(new Date).getTime()+""+Math.random();i+=s,n.open("get",i,!0),n.onerror=function(n){t._abort("server-error","Could not get peers from the server."),e([])},n.onreadystatechange=function(){if(n.readyState!==4)return;if(n.status===401){var r="";throw t.options.host!==m.CLOUD_HOST?r="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":r="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+r)}n.status!==200?e([]):e(JSON.parse(n.responseText))},n.send(null)},e.Peer=a,m.inherits(f,o),f._idPrefix="dc_",f.prototype.initialize=function(e){this._dc=this.dataChannel=e,this._configureDataChannel()},f.prototype._configureDataChannel=function(){var e=this;m.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){m.log("Data channel connection success"),e.open=!0,e.emit("open")},!m.supports.sctp&&this.reliable&&(this._reliable=new u(this._dc,m.debug)),this._reliable?this._reliable.onmessage=function(t){e.emit("data",t)}:this._dc.onmessage=function(t){e._handleDataMessage(t)},this._dc.onclose=function(t){m.log("DataChannel closed for:",e.peer),e.close()}},f.prototype._handleDataMessage=function(e){var t=this,n=e.data,r=n.constructor;if(this.serialization==="binary"||this.serialization==="binary-utf8"){if(r===Blob){m.blobToArrayBuffer(n,function(e){n=m.unpack(e),t.emit("data",n)});return}if(r===ArrayBuffer)n=m.unpack(n);else if(r===String){var i=m.binaryStringToArrayBuffer(n);n=m.unpack(i)}}else this.serialization==="json"&&(n=JSON.parse(n));if(n.__peerData){var s=n.__peerData,o=this._chunkedData[s]||{data:[],count:0,total:n.total};o.data[n.n]=n.data,o.count+=1,o.total===o.count&&(delete this._chunkedData[s],n=new Blob(o.data),this._handleDataMessage({data:n})),this._chunkedData[s]=o;return}this.emit("data",n)},f.prototype.close=function(){if(!this.open)return;this.open=!1,g.cleanup(this),this.emit("close")},f.prototype.send=function(e,t){if(!this.open){this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this._reliable){this._reliable.send(e);return}var n=this;if(this.serialization==="json")this._bufferedSend(JSON.stringify(e));else if(this.serialization==="binary"||this.serialization==="binary-utf8"){var r=m.pack(e),i=m.chunkedBrowsers[this._peerBrowser]||m.chunkedBrowsers[m.browser];if(i&&!t&&r.size>m.chunkedMTU){this._sendChunks(r);return}m.supports.sctp?m.supports.binaryBlob?this._bufferedSend(r):m.blobToArrayBuffer(r,function(e){n._bufferedSend(e)}):m.blobToBinaryString(r,function(e){n._bufferedSend(e)})}else this._bufferedSend(e)},f.prototype._bufferedSend=function(e){if(this._buffering||!this._trySend(e))this._buffer.push(e),this.bufferSize=this._buffer.length},f.prototype._trySend=function(e){try{this._dc.send(e)}catch(t){this._buffering=!0;var n=this;return setTimeout(function(){n._buffering=!1,n._tryBuffer()},100),!1}return!0},f.prototype._tryBuffer=function(){if(this._buffer.length===0)return;var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())},f.prototype._sendChunks=function(e){var t=m.chunk(e);for(var n=0,r=t.length;n<r;n+=1){var e=t[n];this.send(e,!0)}},f.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=t.browser,g.handleSDP(e.type,this,t.sdp);break;case"CANDIDATE":g.handleCandidate(this,t.candidate);break;default:m.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},m.inherits(l,o),l._idPrefix="mc_",l.prototype.addStream=function(e){m.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},l.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":g.handleSDP(e.type,this,t.sdp),this.open=!0;break;case"CANDIDATE":g.handleCandidate(this,t.candidate);break;default:m.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},l.prototype.answer=function(e){if(this.localStream){m.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this.options._payload._stream=e,this.localStream=e,g.startConnection(this,this.options._payload);var t=this.provider._getMessages(this.id);for(var n=0,r=t.length;n<r;n+=1)this.handleMessage(t[n]);this.open=!0},l.prototype.close=function(){if(!this.open)return;this.open=!1,g.cleanup(this),this.emit("close")};var g={pcs:{data:{},media:{}},queue:[]};g._idPrefix="pc_",g.startConnection=function(e,t){var n=g._getPeerConnection(e,t);e.type==="media"&&t._stream&&n.addStream(t._stream),e.pc=e.peerConnection=n;if(t.originator){if(e.type==="data"){var r={};m.supports.sctp||(r={reliable:t.reliable});var i=n.createDataChannel(e.label,r);e.initialize(i)}m.supports.onnegotiationneeded||g._makeOffer(e)}else g.handleSDP("OFFER",e,t.sdp)},g._getPeerConnection=function(e,t){g.pcs[e.type]||m.error(e.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),g.pcs[e.type][e.peer]||(g.pcs[e.type][e.peer]={});var n=g.pcs[e.type][e.peer],r;t.pc&&(r=g.pcs[e.type][e.peer][t.pc]);if(!r||r.signalingState!=="stable")r=g._startPeerConnection(e);return r},g._startPeerConnection=function(e){m.log("Creating RTCPeerConnection.");var t=g._idPrefix+m.randomToken(),n={};e.type==="data"&&!m.supports.sctp?n={optional:[{RtpDataChannels:!0}]}:e.type==="media"&&(n={optional:[{DtlsSrtpKeyAgreement:!0}]});var r=new RTCPeerConnection(e.provider.options.config,n);return g.pcs[e.type][e.peer][t]=r,g._setupListeners(e,r,t),r},g._setupListeners=function(e,t,n){var r=e.peer,i=e.id,s=e.provider;m.log("Listening for ICE candidates."),t.onicecandidate=function(t){t.candidate&&(m.log("Received ICE candidates for:",e.peer),s.socket.send({type:"CANDIDATE",payload:{candidate:t.candidate,type:e.type,connectionId:e.id},dst:r}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"disconnected":case"failed":m.log("iceConnectionState is disconnected, closing connections to "+r),e.close();break;case"completed":t.onicecandidate=m.noop}},t.onicechange=t.oniceconnectionstatechange,m.log("Listening for `negotiationneeded`"),t.onnegotiationneeded=function(){m.log("`negotiationneeded` triggered"),t.signalingState=="stable"?g._makeOffer(e):m.log("onnegotiationneeded triggered when not stable. Is another connection being established?")},m.log("Listening for data channel"),t.ondatachannel=function(e){m.log("Received data channel");var t=e.channel,n=s.getConnection(r,i);n.initialize(t)},m.log("Listening for remote stream"),t.onaddstream=function(e){m.log("Received remote stream");var t=e.stream;s.getConnection(r,i).addStream(t)}},g.cleanup=function(e){m.log("Cleaning up PeerConnection to "+e.peer);var t=e.pc;!!t&&(t.readyState!=="closed"||t.signalingState!=="closed")&&(t.close(),e.pc=null)},g._makeOffer=function(e){var t=e.pc;t.createOffer(function(n){m.log("Created offer."),!m.supports.sctp&&e.type==="data"&&e.reliable&&(n.sdp=u.higherBandwidthSDP(n.sdp)),t.setLocalDescription(n,function(){m.log("Set localDescription: offer","for:",e.peer),e.provider.socket.send({type:"OFFER",payload:{sdp:n,type:e.type,label:e.label,connectionId:e.id,reliable:e.reliable,serialization:e.serialization,metadata:e.metadata,browser:m.browser},dst:e.peer})},function(t){e.provider.emitError("webrtc",t),m.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emitError("webrtc",t),m.log("Failed to createOffer, ",t)},e.options.constraints)},g._makeAnswer=function(e){var t=e.pc;t.createAnswer(function(n){m.log("Created answer."),!m.supports.sctp&&e.type==="data"&&e.reliable&&(n.sdp=u.higherBandwidthSDP(n.sdp)),t.setLocalDescription(n,function(){m.log("Set localDescription: answer","for:",e.peer),e.provider.socket.send({type:"ANSWER",payload:{sdp:n,type:e.type,connectionId:e.id,browser:m.browser},dst:e.peer})},function(t){e.provider.emitError("webrtc",t),m.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emitError("webrtc",t),m.log("Failed to create answer, ",t)})},g.handleSDP=function(e,t,n){n=new RTCSessionDescription(n);var r=t.pc;m.log("Setting remote description",n),r.setRemoteDescription(n,function(){m.log("Set remoteDescription:",e,"for:",t.peer),e==="OFFER"&&g._makeAnswer(t)},function(e){t.provider.emitError("webrtc",e),m.log("Failed to setRemoteDescription, ",e)})},g.handleCandidate=function(e,t){var n=t.candidate,r=t.sdpMLineIndex;e.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:r,candidate:n})),m.log("Added ICE candidate for:",e.peer)},m.inherits(c,o),c.prototype.start=function(e,t){this.id=e,this._httpUrl+="/"+e+"/"+t,this._wsUrl+="&id="+e+"&token="+t,this._startXhrStream(),this._startWebSocket()},c.prototype._startWebSocket=function(e){var t=this;if(this._socket)return;this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(e){try{var n=JSON.parse(e.data);t.emit("message",n)}catch(r){m.log("Invalid server message",e.data);return}},this._socket.onclose=function(e){m.log("Socket closed."),t.disconnected=!0,t.emit("disconnected")},this._socket.onopen=function(){t._timeout&&(clearTimeout(t._timeout),setTimeout(function(){t._http.abort(),t._http=null},5e3)),t._sendQueuedMessages(),m.log("Socket open")}},c.prototype._startXhrStream=function(e){try{var t=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onreadystatechange=function(){this.readyState==2&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&this.status===200&&this.responseText?t._handleStream(this):this.status!==200&&(clearTimeout(t._timeout),t.emit("disconnected"))},this._http.send(null),this._setHTTPTimeout()}catch(n){m.log("XMLHttpRequest not available; defaulting to WebSockets")}},c.prototype._handleStream=function(e){var t=e.responseText.split("\n");if(e._buffer)while(e._buffer.length>0){var n=e._buffer.shift(),r=t[n];try{r=JSON.parse(r)}catch(i){e._buffer.shift(n);break}this.emit("message",r)}var s=t[e._index];if(s){e._index+=1;if(e._index===t.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{s=JSON.parse(s)}catch(i){m.log("Invalid server message",s);return}this.emit("message",s)}}},c.prototype._setHTTPTimeout=function(){var e=this;this._timeout=setTimeout(function(){var t=e._http;e._wsOpen()?t.abort():(e._startXhrStream(t._streamIndex+1),e._http.old=t)},25e3)},c.prototype._wsOpen=function(){return this._socket&&this._socket.readyState==1},c.prototype._sendQueuedMessages=function(){for(var e=0,t=this._queue.length;e<t;e+=1)this.send(this._queue[e])},c.prototype.send=function(e){if(this.disconnected)return;if(!this.id){this._queue.push(e);return}if(!e.type){this.emit("error","Invalid message");return}var t=JSON.stringify(e);if(this._wsOpen())this._socket.send(t);else{var n=new XMLHttpRequest,r=this._httpUrl+"/"+e.type.toLowerCase();n.open("post",r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(t)}},c.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)}})(this);var dbits,canary=0xdeadbeefcafe,j_lm=(canary&16777215)==15715070;j_lm&&navigator.appName=="Microsoft Internet Explorer"?(BigInteger.prototype.am=am2,dbits=30):j_lm&&navigator.appName!="Netscape"?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28);BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=[],rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=67108864/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;(function(e,t,n,r,i,s,o){function u(e){var t,r,i=this,s=e.length,o=0,u=i.i=i.j=i.m=0;i.S=[];i.c=[];for(s||(e=[s++]);o<n;)i.S[o]=o++;for(o=0;o<n;o++)t=i.S[o],u=u+t+e[o%s]&n-1,r=i.S[u],i.S[o]=r,i.S[u]=t;i.g=function(e){var t=i.S,r=i.i+1&n-1,s=t[r],o=i.j+s&n-1,u=t[o];t[r]=u;t[o]=s;for(var a=t[s+u&n-1];--e;)r=r+1&n-1,s=t[r],o=o+s&n-1,u=t[o],t[r]=u,t[o]=s,a=a*n+t[s+u&n-1];i.i=r;i.j=o;return a};i.g(n)}function a(e,t,n,r,i){n=[];i=typeof e;if(t&&i=="object")for(r in e)if(r.indexOf("S")<5)try{n.push(a(e[r],t-1))}catch(s){}return n.length?n:e+(i!="string"?"\0":"")}function f(e,t,r,i){e+="";for(i=r=0;i<e.length;i++){var s=t,o=i&n-1,u=(r^=t[i&n-1]*19)+e.charCodeAt(i);s[o]=u&n-1}e="";for(i in t)e+=String.fromCharCode(t[i]);return e}t.seedrandom=function(l,v){var m=[],y,l=f(a(v?[l,e]:arguments.length?l:[(new Date).getTime(),e,window],3),m);y=new u(m);f(y.S,e);t.random=function(){for(var e=y.g(r),t=o,u=0;e<i;)e=(e+u)*n,t*=n,u=y.g(1);for(;e>=s;)e/=2,t/=2,u>>>=1;return(e+u)/t};return l};o=t.pow(n,r);i=t.pow(2,i);s=i*2;f(t.random(),e)})([],Math,256,6,52);SeededRandom.prototype.nextBytes=SRnextBytes;Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;var rng_psize=256,rng_state,rng_pool,rng_pptr;if(rng_pool==null){rng_pool=[];rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=z.charCodeAt(t)&255}for(;rng_pptr<rng_psize;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=t&255;rng_pptr=0;rng_seed_time()}SecureRandom.prototype.nextBytes=rng_get_bytes;var sha256={hex:function(e){return SHA256(e)}};var sha1={hex:function(e){return SHA1(e)}},MD5=function(e){function t(e,t){var n,r,i,s,o;i=e&2147483648;s=t&2147483648;n=e&1073741824;r=t&1073741824;o=(e&1073741823)+(t&1073741823);return n&r?o^2147483648^i^s:n|r?o&1073741824?o^3221225472^i^s:o^1073741824^i^s:o^i^s}function n(e,n,r,i,s,o,u){e=t(e,t(t(n&r|~n&i,s),u));return t(e<<o|e>>>32-o,n)}function r(e,n,r,i,s,o,u){e=t(e,t(t(n&i|r&~i,s),u));return t(e<<o|e>>>32-o,n)}function i(e,n,r,i,s,o,u){e=t(e,t(t(n^r^i,s),u));return t(e<<o|e>>>32-o,n)}function s(e,n,r,i,s,o,u){e=t(e,t(t(r^(n|~i),s),u));return t(e<<o|e>>>32-o,n)}function o(e){var t="",n="",r;for(r=0;r<=3;r++)n=e>>>r*8&255,n="0"+n.toString(16),t+=n.substr(n.length-2,2);return t}var u=[],a,f,l,c,h,p,d,v,e=function(e){for(var e=e.replace(/\r\n/g,"\n"),t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(r>127&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(r&63|128))}return t}(e),u=function(e){var t,n=e.length;t=n+8;for(var r=((t-t%64)/64+1)*16,i=Array(r-1),s=0,o=0;o<n;)t=(o-o%4)/4,s=o%4*8,i[t]|=e.charCodeAt(o)<<s,o++;i[(o-o%4)/4]|=128<<o%4*8;i[r-2]=n<<3;i[r-1]=n>>>29;return i}(e);h=1732584193;p=4023233417;d=2562383102;v=271733878;for(e=0;e<u.length;e+=16)a=h,f=p,l=d,c=v,h=n(h,p,d,v,u[e+0],7,3614090360),v=n(v,h,p,d,u[e+1],12,3905402710),d=n(d,v,h,p,u[e+2],17,606105819),p=n(p,d,v,h,u[e+3],22,3250441966),h=n(h,p,d,v,u[e+4],7,4118548399),v=n(v,h,p,d,u[e+5],12,1200080426),d=n(d,v,h,p,u[e+6],17,2821735955),p=n(p,d,v,h,u[e+7],22,4249261313),h=n(h,p,d,v,u[e+8],7,1770035416),v=n(v,h,p,d,u[e+9],12,2336552879),d=n(d,v,h,p,u[e+10],17,4294925233),p=n(p,d,v,h,u[e+11],22,2304563134),h=n(h,p,d,v,u[e+12],7,1804603682),v=n(v,h,p,d,u[e+13],12,4254626195),d=n(d,v,h,p,u[e+14],17,2792965006),p=n(p,d,v,h,u[e+15],22,1236535329),h=r(h,p,d,v,u[e+1],5,4129170786),v=r(v,h,p,d,u[e+6],9,3225465664),d=r(d,v,h,p,u[e+11],14,643717713),p=r(p,d,v,h,u[e+0],20,3921069994),h=r(h,p,d,v,u[e+5],5,3593408605),v=r(v,h,p,d,u[e+10],9,38016083),d=r(d,v,h,p,u[e+15],14,3634488961),p=r(p,d,v,h,u[e+4],20,3889429448),h=r(h,p,d,v,u[e+9],5,568446438),v=r(v,h,p,d,u[e+14],9,3275163606),d=r(d,v,h,p,u[e+3],14,4107603335),p=r(p,d,v,h,u[e+8],20,1163531501),h=r(h,p,d,v,u[e+13],5,2850285829),v=r(v,h,p,d,u[e+2],9,4243563512),d=r(d,v,h,p,u[e+7],14,1735328473),p=r(p,d,v,h,u[e+12],20,2368359562),h=i(h,p,d,v,u[e+5],4,4294588738),v=i(v,h,p,d,u[e+8],11,2272392833),d=i(d,v,h,p,u[e+11],16,1839030562),p=i(p,d,v,h,u[e+14],23,4259657740),h=i(h,p,d,v,u[e+1],4,2763975236),v=i(v,h,p,d,u[e+4],11,1272893353),d=i(d,v,h,p,u[e+7],16,4139469664),p=i(p,d,v,h,u[e+10],23,3200236656),h=i(h,p,d,v,u[e+13],4,681279174),v=i(v,h,p,d,u[e+0],11,3936430074),d=i(d,v,h,p,u[e+3],16,3572445317),p=i(p,d,v,h,u[e+6],23,76029189),h=i(h,p,d,v,u[e+9],4,3654602809),v=i(v,h,p,d,u[e+12],11,3873151461),d=i(d,v,h,p,u[e+15],16,530742520),p=i(p,d,v,h,u[e+2],23,3299628645),h=s(h,p,d,v,u[e+0],6,4096336452),v=s(v,h,p,d,u[e+7],10,1126891415),d=s(d,v,h,p,u[e+14],15,2878612391),p=s(p,d,v,h,u[e+5],21,4237533241),h=s(h,p,d,v,u[e+12],6,1700485571),v=s(v,h,p,d,u[e+3],10,2399980690),d=s(d,v,h,p,u[e+10],15,4293915773),p=s(p,d,v,h,u[e+1],21,2240044497),h=s(h,p,d,v,u[e+8],6,1873313359),v=s(v,h,p,d,u[e+15],10,4264355552),d=s(d,v,h,p,u[e+6],15,2734768916),p=s(p,d,v,h,u[e+13],21,1309151649),h=s(h,p,d,v,u[e+4],6,4149444226),v=s(v,h,p,d,u[e+11],10,3174756917),d=s(d,v,h,p,u[e+2],15,718787259),p=s(p,d,v,h,u[e+9],21,3951481745),h=t(h,a),p=t(p,f),d=t(d,l),v=t(v,c);return(o(h)+o(p)+o(d)+o(v)).toLowerCase()};RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;RSAKey.prototype.doPrivate=RSADoPrivate;RSAKey.prototype.setPrivate=RSASetPrivate;RSAKey.prototype.setPrivateEx=RSASetPrivateEx;RSAKey.prototype.generate=RSAGenerate;RSAKey.prototype.decrypt=RSADecrypt;var _RSASIGN_DIHEAD=[];_RSASIGN_DIHEAD.sha1="3021300906052b0e03021a05000414";_RSASIGN_DIHEAD.sha256="3031300d060960864801650304020105000420";var _RSASIGN_HASHHEXFUNC=[];_RSASIGN_HASHHEXFUNC.sha1=sha1.hex;_RSASIGN_HASHHEXFUNC.sha256=sha256.hex;RSAKey.prototype.signString=_rsasign_signString;RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1;RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256;RSAKey.prototype.verifyString=_rsasign_verifyString;RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage;var aes=function(){var e={Sbox:[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ShiftRowTab:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11]};e.Init=function(){e.Sbox_Inv=Array(256);for(var t=0;t<256;t++)e.Sbox_Inv[e.Sbox[t]]=t;e.ShiftRowTab_Inv=Array(16);for(t=0;t<16;t++)e.ShiftRowTab_Inv[e.ShiftRowTab[t]]=t;e.xtime=Array(256);for(t=0;t<128;t++)e.xtime[t]=t<<1,e.xtime[128+t]=t<<1^27};e.Done=function(){delete e.Sbox_Inv;delete e.ShiftRowTab_Inv;delete e.xtime};e.ExpandKey=function(t){var n=t.length,r,i=1;switch(n){case 16:r=176;break;case 24:r=208;break;case 32:r=240;break;default:alert("my.ExpandKey: Only key lengths of 16, 24 or 32 bytes allowed!")}for(var s=n;s<r;s+=4){var o=t.slice(s-4,s);if(s%n==0){if(o=[e.Sbox[o[1]]^i,e.Sbox[o[2]],e.Sbox[o[3]],e.Sbox[o[0]]],(i<<=1)>=256)i^=283}else n>24&&s%n==16&&(o=[e.Sbox[o[0]],e.Sbox[o[1]],e.Sbox[o[2]],e.Sbox[o[3]]]);for(var u=0;u<4;u++)t[s+u]=t[s+u-n]^o[u]}};e.Encrypt=function(t,n){var r=n.length;e.AddRoundKey(t,n.slice(0,16));for(var i=16;i<r-16;i+=16)e.SubBytes(t,e.Sbox),e.ShiftRows(t,e.ShiftRowTab),e.MixColumns(t),e.AddRoundKey(t,n.slice(i,i+16));e.SubBytes(t,e.Sbox);e.ShiftRows(t,e.ShiftRowTab);e.AddRoundKey(t,n.slice(i,r))};e.Decrypt=function(t,n){var r=n.length;e.AddRoundKey(t,n.slice(r-16,r));e.ShiftRows(t,e.ShiftRowTab_Inv);e.SubBytes(t,e.Sbox_Inv);for(r-=32;r>=16;r-=16)e.AddRoundKey(t,n.slice(r,r+16)),e.MixColumns_Inv(t),e.ShiftRows(t,e.ShiftRowTab_Inv),e.SubBytes(t,e.Sbox_Inv);e.AddRoundKey(t,n.slice(0,16))};e.SubBytes=function(e,t){for(var n=0;n<16;n++)e[n]=t[e[n]]};e.AddRoundKey=function(e,t){for(var n=0;n<16;n++)e[n]^=t[n]};e.ShiftRows=function(e,t){for(var n=[].concat(e),r=0;r<16;r++)e[r]=n[t[r]]};e.MixColumns=function(t){for(var n=0;n<16;n+=4){var r=t[n+0],i=t[n+1],s=t[n+2],o=t[n+3],u=r^i^s^o;t[n+0]^=u^e.xtime[r^i];t[n+1]^=u^e.xtime[i^s];t[n+2]^=u^e.xtime[s^o];t[n+3]^=u^e.xtime[o^r]}};e.MixColumns_Inv=function(t){for(var n=0;n<16;n+=4){var r=t[n+0],i=t[n+1],s=t[n+2],o=t[n+3],u=r^i^s^o,f=e.xtime[u],l=e.xtime[e.xtime[f^r^s]]^u;u^=e.xtime[e.xtime[f^i^o]];t[n+0]^=l^e.xtime[r^i];t[n+1]^=u^e.xtime[i^s];t[n+2]^=l^e.xtime[s^o];t[n+3]^=u^e.xtime[o^r]}};return e}(),cryptico=function(){var e={};aes.Init();e.b256to64=function(e){var t,n,r,i="",s=0,o=0,u=e.length;for(r=0;r<u;r++)n=e.charCodeAt(r),o==0?(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>2&63),t=(n&3)<<4):o==1?(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t|n>>4&15),t=(n&15)<<2):o==2&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t|n>>6&3),s+=1,i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n&63)),s+=1,o+=1,o==3&&(o=0);o>0&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t),i+="=");o==1&&(i+="=");return i};e.b64to256=function(e){var t,n,r="",i=0,s=0,o=e.length;for(n=0;n<o;n++)t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(n)),t>=0&&(i&&(r+=String.fromCharCode(s|t>>6-i&255)),i=i+2&7,s=t<<i&255);return r};e.b16to64=function(e){var t,n,r="";e.length%2==1&&(e="0"+e);for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n&63);t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((n&3)<<4));for(;(r.length&3)>0;)r+="=";return r};e.b64to16=function(e){var t="",n,r=0,i;for(n=0;n<e.length;++n){if(e.charAt(n)=="=")break;v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(n));v<0||(r==0?(t+=int2char(v>>2),i=v&3,r=1):r==1?(t+=int2char(i<<2|v>>4),i=v&15,r=2):r==2?(t+=int2char(i),t+=int2char(v>>2),i=v&3,r=3):(t+=int2char(i<<2|v>>4),t+=int2char(v&15),r=0))}r==1&&(t+=int2char(i<<2));return t};e.string2bytes=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t};e.bytes2string=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t};e.blockXOR=function(e,t){for(var n=Array(16),r=0;r<16;r++)n[r]=e[r]^t[r];return n};e.blockIV=function(){var e=new SecureRandom,t=Array(16);e.nextBytes(t);return t};e.pad16=function(e){var t=e.slice(0),n=(16-e.length%16)%16;for(i=e.length;i<e.length+n;i++)t.push(0);return t};e.depad=function(e){for(e=e.slice(0);e[e.length-1]==0;)e=e.slice(0,e.length-1);return e};e.encryptAESCBC=function(t,n){var r=n.slice(0);aes.ExpandKey(r);for(var i=e.string2bytes(t),i=e.pad16(i),s=e.blockIV(),o=0;o<i.length/16;o++){var u=i.slice(o*16,o*16+16),f=s.slice(o*16,o*16+16),u=e.blockXOR(f,u);aes.Encrypt(u,r);s=s.concat(u)}r=e.bytes2string(s);return e.b256to64(r)};e.decryptAESCBC=function(t,n){var r=n.slice(0);aes.ExpandKey(r);for(var t=e.b64to256(t),i=e.string2bytes(t),s=[],o=1;o<i.length/16;o++){var u=i.slice(o*16,o*16+16),f=i.slice((o-1)*16,(o-1)*16+16);aes.Decrypt(u,r);u=e.blockXOR(f,u);s=s.concat(u)}s=e.depad(s);return e.bytes2string(s)};e.wrap60=function(e){for(var t="",n=0;n<e.length;n++)n%60==0&&n!=0&&(t+="\n"),t+=e[n];return t};e.generateAESKey=function(){var e=Array(32);(new SecureRandom).nextBytes(e);return e};e.generateRSAKey=function(e,t){Math.seedrandom(sha256.hex(e));var n=new RSAKey;n.generate(t,"03");return n};e.publicKeyString=function(t){return pubkey=e.b16to64(t.n.toString(16))};e.publicKeyID=function(e){return MD5(e)};e.publicKeyFromString=function(t){var t=e.b64to16(t.split("|")[0]),n=new RSAKey;n.setPublic(t,"03");return n};e.encrypt=function(t,n,r){var i="",s=e.generateAESKey();try{var o=e.publicKeyFromString(n);i+=e.b16to64(o.encrypt(e.bytes2string(s)))+"?"}catch(u){return{status:"Invalid public key"}}r&&(signString=cryptico.b16to64(r.signString(t,"sha256")),t+="::52cee64bb3a38f6403386519a39ac91c::",t+=cryptico.publicKeyString(r),t+="::52cee64bb3a38f6403386519a39ac91c::",t+=signString);i+=e.encryptAESCBC(t,s);return{status:"success",cipher:i}};e.decrypt=function(t,n){var r=t.split("?"),i=n.decrypt(e.b64to16(r[0]));if(i==null)return{status:"failure"};i=e.string2bytes(i);r=e.decryptAESCBC(r[1],i).split("::52cee64bb3a38f6403386519a39ac91c::");if(r.length==3){var i=e.publicKeyFromString(r[1]),s=e.b64to16(r[2]);return i.verifyString(r[0],s)?{status:"success",plaintext:r[0],signature:"verified",publicKeyString:e.publicKeyString(i)}:{status:"success",plaintext:r[0],signature:"forged",publicKeyString:e.publicKeyString(i)}}else return{status:"success",plaintext:r[0],signature:"unsigned"}};return e}();var notification=new Audio("/sounds/fb.mp3");var PassPhrase;var anotherPeerId;var anotherId;var PublicKeyString;var RSAkey;var Bits=2048;PassPhrase=getRandomStr(200);RSAkey=cryptico.generateRSAKey(PassPhrase,Bits);PublicKeyString=cryptico.publicKeyString(RSAkey);$("#connect").click(function(){anotherId=$("#another_id").val().split(",");anotherPeerId=anotherId[0];PassPhrase=anotherId[1];RSAkey=cryptico.generateRSAKey(PassPhrase,Bits);PublicKeyString=cryptico.publicKeyString(RSAkey)});var peer=new Peer({key:"peerjs",host:"91.122.61.86",port:9e3,path:""});var connectedPeers={};peer.on("open",function(e){$("#own_id").val(e+","+PassPhrase)});peer.on("connection",connect);peer.on("error",function(e){console.log(e)});$(document).ready(function(e){function t(e){e.preventDefault();e.stopPropagation()}function n(e){var t=$(".active");var n={};console.log(t);t.each(function(){var t=$(this).attr("id");if(!n[t]){var r=peer.connections[t];for(var i=0,s=r.length;i<s;i+=1){var o=r[i];e(o,$(this))}}n[t]=1})}$("#connect").click(function(){var e=anotherPeerId;if(!connectedPeers[e]){var t=peer.connect(e,{label:"chat",serialization:"none",metadata:{message:"hi i want to chat with you!"}});t.on("open",function(){connect(t)});t.on("error",function(e){alert(e)});connectedPeers[e]=1}});$("#send").submit(function(e){e.preventDefault();var t=$("#text").val();if(t!=""&&t!=" "){n(function(e,n){if(e.label==="chat"){var r=cryptico.encrypt(encode(t),window.PublicKeyString);e.send(r.cipher);n.find(".messages").append('<div class="message_block you"><span class="date">'+(new Date).getHours()+":"+addZero((new Date).getMinutes())+'</span> <span class="me">Me:</span><div class="message">'+escapeHtml(t).replace(/([^>])\n/g,"$1<br/>")+"</div></div>");$("html, body").animate({scrollTop:$(document).height()},"slow")}})}$("#text").val("");$("#text").focus()})});window.onunload=window.onbeforeunload=function(e){if(!!peer&&!peer.destroyed){console.log("peer destroy");peer.destroy()}}